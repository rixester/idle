<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Calculadora de Evolu√ß√£o (com Skill Drop)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    input, select, button { padding: 8px; margin: 5px 0; }
    #resultado { margin-top: 15px; font-weight: bold; line-height: 1.5; }
    .bloco { margin-top: 12px; padding: 10px; border: 1px solid #ccc; background:#f9f9f9; }
    label { display:block; margin-top:8px; }
	.td{text-align: left;padding: 8px;}
  </style>
</head>
<body>
  <h2>Calculadora de Evolu√ß√£o (com Skill Drop)</h2>
<table border="0" style="width:900px"><tbody>
<tr><td>Amuletos de drop (0 a 27): <br><input type="number" id="baseIncrease" min="0" max="27" value="0" placeholder"0"></td>
<td>N√∫mero de transmiga√ß√µes: <br><input type="number" id="resets" min="0" value="0" placeholder"0"></td>
<td>Skill de Drop<br>(Transcend√™ncia): <br><input type="number" id="skillDrop" min="0" max="3" value="0" placeholder"0"></td></tr>

<tr><td>Quantidade de Soul Box<br>atual: <br>
  <input type="number" id="boxAtual" min="0" value="0" placeholder"0"></td>
  <td>
  Quantidade de Job Keys<br>atual: <br>
  <input type="number" id="keysAtual" min="0" value="0" placeholder"0"></td><td></td></tr>
<tr><td>N√≠vel inicial: <br>
  <input type="number" id="nivelInicial" min="1" value="1" placeholder"1">

  </td><td>N√≠vel final: <br>
  <input type="number" id="nivelFinal" min="2" value="2" placeholder"2"></td><td></td></tr>
</tbody>
</table>
 
 


  <button onclick="calcular()">Calcular</button>

  <div id="resultado"></div>

  <script>
    function f(n){ return n.toLocaleString('pt-BR'); }

    const RESET_MAP = [
      [1,1]  ,[2,2]  ,[4,3]  ,[6,4]  ,[8,5]  ,[10,6] ,[13,7] ,[15,8],[19,9],
      [22,10],[25,11],[29,12],[33,13],[37,14],[41,15],[46,16],
      [50,17],[55,18],[60,19],[66,20],[71,21]
    ];

    function getResetIncrease(resets) {
      let inc = 0;
      for (let i = 0; i < RESET_MAP.length; i++) {
        if (resets >= RESET_MAP[i][0]) inc = RESET_MAP[i][1];
        else break;
      }
      return inc;
    }

    function getSkillMultiplier(skill) {
      if (skill === 1) return 2;
      if (skill === 2) return 3;
      if (skill === 3) return 4;
      if (skill === 5) return 5;
      return 1;
    }

    function somaSoulBoxes(inicio, fim) {
      let total = 0;
      for (let n = inicio; n < fim; n++) total += 50 * n;
      return total;
    }

    function calcularOndasNecessarias(keysNecessarias, baseIncrease, resetIncrease, skillMult) {
      if (keysNecessarias <= 0) return 0;
      let ondas = 0, keys = 0;
      const baseRecompensas = [1,2,4,8,16,32,64,128,256];
      const extra = 1 + baseIncrease + resetIncrease;

      // at√© 180 ondas
      for (let i = 0; i < baseRecompensas.length; i++) {
        ondas = (i+1) * 20;
        keys += (baseRecompensas[i] + extra) * skillMult;
        if (keys >= keysNecessarias) return ondas;
      }

      // 200 a 980
      for (let onda = 200; onda <= 980; onda += 20) {
        ondas = onda;
        keys += (512 + extra) * skillMult;
        if (keys >= keysNecessarias) return ondas;
      }

      // acima de 1000
      for (let onda = 1000; ; onda += 20) {
        ondas = onda;
        keys += (1024 + extra) * skillMult;
        if (keys >= keysNecessarias) return ondas;
      }
    }

    function compilarResultado(inicio, fim, boxAtual, keysAtual, baseIncrease, resets, skill) {
      const niveis = fim - inicio;
      const totalSoul = somaSoulBoxes(inicio, fim);
      const custoLiquidoSoul = Math.max(totalSoul - boxAtual, 0);
      const conversaoKeys = custoLiquidoSoul * 3;
      const reinjectSoul = niveis * 750;
      const reinjectKeys = niveis * 1500;
      const totalKeysBruto = conversaoKeys + reinjectKeys;
      const totalKeysFinal = Math.max(totalKeysBruto - keysAtual, 0);

      const resetIncrease = getResetIncrease(resets);
      const skillMult = getSkillMultiplier(skill);
      const extraPerBlock = (1 + baseIncrease + resetIncrease) * skillMult;
      const ondas = calcularOndasNecessarias(totalKeysFinal, baseIncrease, resetIncrease, skillMult);

      return {
        niveis, totalSoul, custoLiquidoSoul, conversaoKeys,
        reinjectSoul, reinjectKeys, totalKeysBruto, keysAtual,
        totalKeysFinal, resetIncrease, baseIncrease, skillMult,
        extraPerBlock, ondas
      };
    }

    function calcular() {
      const inicio = parseInt(document.getElementById('nivelInicial').value, 10);
      const fim = parseInt(document.getElementById('nivelFinal').value, 10);
      const boxAtual = parseInt(document.getElementById('boxAtual').value, 10) || 0;
      const keysAtual = parseInt(document.getElementById('keysAtual').value, 10) || 0;
      let baseIncrease = parseInt(document.getElementById('baseIncrease').value, 10);
      if (isNaN(baseIncrease)) baseIncrease = 0;
      baseIncrease = Math.max(0, Math.min(27, baseIncrease));
      const resets = parseInt(document.getElementById('resets').value, 10) || 0;
      const skill = parseInt(document.getElementById('skillDrop').value, 10) || 0;

      const resultadoEl = document.getElementById('resultado');
      resultadoEl.innerHTML = '';

      if (isNaN(inicio) || isNaN(fim) || fim <= inicio) {
        resultadoEl.innerText = 'O n√≠vel final deve ser maior que o inicial.';
        return;
      }

      const r = compilarResultado(inicio, fim, boxAtual, keysAtual, baseIncrease, resets, skill);

      let html = `<div class="bloco">`;
      html += `üî∏ Dados de Drops<br>`;
      html += `‚û°Ô∏è Acc Drop: <b>${f(r.baseIncrease)} item</b><br>`;
      html += `‚û°Ô∏è Runs Drop: <b>${f(r.resetIncrease + 1)} item</b><br>`;
      html += `‚û°Ô∏è Skill Drop Mult: <b>x${r.skillMult}</b><br>`;
      html += `‚û°Ô∏è Total Drop: <b>${f(r.extraPerBlock)}</b><br><br>`;
	  
	  
      
      html += `üîπ Evoluir do n√≠vel <b>${inicio}</b> at√© <b>${fim}</b><br>`;
      html += `‚ûù Soul Weapons Necess√°rios: <b>${f(r.totalSoul)}</b> Soul of weapons (${f(r.totalSoul)} box + ${f(r.totalSoul)} keys)<br><br>`;
      
	  html += `‚ûù Estoque: ${f(boxAtual)} box ‚Üí Precisa obter: <b>${f(r.custoLiquidoSoul)}</b> box ou <b>${f(r.conversaoKeys)}</b> keys  para converter em soul box)<br><br>`;
	  
      html += `‚ûù Para os Re-injects: <b>${f(r.reinjectSoul)}</b> Soul box ou <b>${f(r.reinjectKeys)}</b> Job Key<br>`;
      html += `‚ûù Subtotal: <b>${f(r.totalKeysBruto)}</b> Job Key<br><br>`;
	  
      html += `‚ûù Estoque: ${f(r.keysAtual)} Job Keys<br>`;
      html += `‚ûù Obter um Total final: <b>${f(r.totalKeysFinal)}</b> Job Key<br><br>`;

      html += `‚ûù Ondas necess√°rias: <b>${f(r.ondas)}</b> ondas`;
      html += `</div>`;

      resultadoEl.innerHTML = html;
    }
  </script>
</body>
</html>
